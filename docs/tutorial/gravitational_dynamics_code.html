

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Adding a Gravitational Dynamics Code &mdash; AMUSE 12.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Create an low-level Interface to a Code" href="legacy_code.html" />
    <link rel="prev" title="Integrate a Fortran 90 code" href="fortran_code.html" />
     
    <link rel="stylesheet" href="../_static/default.css" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> AMUSE
          

          
          </a>

          
            
            
              <div class="version">
                12.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="units.html">Working with Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="units.html#quantities">Quantities</a></li>
<li class="toctree-l2"><a class="reference internal" href="units.html#working-with-arrays">Working with arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="most_massive_from_salpeter.html">Estimating the typical mass of the most massive star in a cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="particle_sets.html">Working with Particle Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="c_code.html">Integrate a C++ code</a></li>
<li class="toctree-l2"><a class="reference internal" href="fortran_code.html">Integrate a Fortran 90 code</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Adding a Gravitational Dynamics Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#environment-variables">Environment variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-an-initial-directory-structure">Creating an initial directory structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-src-directory">The src directory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="legacy_code.html">Create an low-level Interface to a Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="blender.html">Using Blender for visualising Amuse results</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot.html">Plotting with amuse</a></li>
<li class="toctree-l2"><a class="reference internal" href="grid_boundary.html">Setting values for grid boundaries</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../interactive_tutorial/index.html">Interactive tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/index.html">Design documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AMUSE</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Tutorials</a> &raquo;</li>
        
      <li>Adding a Gravitational Dynamics Code</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorial/gravitational_dynamics_code.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="adding-a-gravitational-dynamics-code">
<h1>Adding a Gravitational Dynamics Code<a class="headerlink" href="#adding-a-gravitational-dynamics-code" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial we explain the steps to take when integrating
a new gravitational dynamics code.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This tutorial will show the steps but will not finish in a
working product. It will highlight the steps to take, we
recommend you first read these tutorials
<a class="reference internal" href="c_code.html"><span class="doc">Integrate a C++ code</span></a> and <a class="reference internal" href="fortran_code.html"><span class="doc">Integrate a Fortran 90 code</span></a>.</p>
</div>
<div class="section" id="environment-variables">
<h2>Environment variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h2>
<p>To simplify the work in the coming sections, we first define the
environment variable ‘AMUSE_DIR’. This environment variable must
point to the root directory of AMUSE (this is the directory
containing the build.py script).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; <span class="nb">export</span> <span class="nv">AMUSE_DIR</span><span class="o">=</span>&lt;path to the amuse root directory&gt;
</pre></div>
</div>
<p>or in a c shell:</p>
<div class="highlight-csh notranslate"><div class="highlight"><pre><span></span>&gt; <span class="nb">setenv </span>AMUSE_DIR &lt;path to the amuse root directory&gt;
</pre></div>
</div>
<p>After building the code, we want to run and test the code. Check if
amuse is available in your python path by running the following code
on the command line.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; python -c <span class="s2">&quot;import amuse&quot;</span>
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
File <span class="s2">&quot;&lt;string&gt;&quot;</span>, line <span class="m">1</span>, in &lt;module&gt;
ImportError: No module named amuse
</pre></div>
</div>
<p>If this code ends in a “ImportError” as shown in the example, the
PYTHONPATH environment variable must be extended with the src directory
in AMUSE_DIR.
We can do so by using one of the following commands.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; <span class="nb">export</span> <span class="nv">PYTHONPATH</span><span class="o">=</span><span class="si">${</span><span class="nv">PYTHONPATH</span><span class="si">}</span>:<span class="si">${</span><span class="nv">AMUSE_DIR</span><span class="si">}</span>/src
</pre></div>
</div>
<p>or in a c shell:</p>
<div class="highlight-csh notranslate"><div class="highlight"><pre><span></span>&gt; <span class="nb">setenv </span>PYTHONPATH <span class="k">${</span><span class="nv">PYTHONPATH</span><span class="k">}</span>:<span class="k">${</span><span class="nv">AMUSE_DIR</span><span class="k">}</span>/src
</pre></div>
</div>
</div>
<div class="section" id="creating-an-initial-directory-structure">
<h2>Creating an initial directory structure<a class="headerlink" href="#creating-an-initial-directory-structure" title="Permalink to this headline">¶</a></h2>
<p>First we need to create a directory for our project and put some
files in it to help build the code. The fastest method to setup the
directory is by using the build.py script.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>&gt; <span class="c1"># for C/C++ codes:</span>
&gt; <span class="nv">$AMUSE_DIR</span>/build.py --type<span class="o">=</span>c --mode<span class="o">=</span>dir CodeName
&gt; <span class="c1"># for fortran codes:</span>
&gt; <span class="nv">$AMUSE_DIR</span>/build.py --type<span class="o">=</span>f90 --mode<span class="o">=</span>dir CodeName
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal notranslate"><span class="pre">`CodeName`</span></code> should be an unique name for your code. It
should follow python rules for class names, start with
an uppercase letter and have an uppercase letter for each word
in the name (camelcase).</p>
</div>
<p>This script will create a directory called <code class="docutils literal notranslate"><span class="pre">`codename`</span></code>. The script
will populate the directory with a make file (<code class="docutils literal notranslate"><span class="pre">`Makefile`</span></code>), a python interface
definition file (<code class="docutils literal notranslate"><span class="pre">`interface.py`</span></code>) and a C or fortran stub file
(containing methods implementing the definitions in interface.py,
<code class="docutils literal notranslate"><span class="pre">`interface.cc`</span></code> or <code class="docutils literal notranslate"><span class="pre">`interface.f90`</span></code>).</p>
</div>
<div class="section" id="the-src-directory">
<h2>The src directory<a class="headerlink" href="#the-src-directory" title="Permalink to this headline">¶</a></h2>
<p>The build.py script creates a <code class="docutils literal notranslate"><span class="pre">`src`</span></code> directory in the <code class="docutils literal notranslate"><span class="pre">`codename`</span></code>
directory. The <code class="docutils literal notranslate"><span class="pre">`src`</span></code> directory should contain a make file and
the sources of the code to integrate. (The build.py script also creates
some files in the <code class="docutils literal notranslate"><span class="pre">`src`</span></code> directory as an example, but you
can remove and overwrite everything in this directory)</p>
<p>The generated build system will call the make file with the
<code class="docutils literal notranslate"><span class="pre">`all`</span></code> target (to build an stand-alone executable, if available)
and the <code class="docutils literal notranslate"><span class="pre">`libcodename.a`</span></code> target (to build a static library with
all necessary object files).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If your code has a different build system or if the makefile is
not in the main directory of the code you need to edit the
generated make file in the <code class="docutils literal notranslate"><span class="pre">`codename`</span></code> directory. The AMUSE
codebase contains several codes that have a different build
system, please look into the code for <code class="docutils literal notranslate"><span class="pre">`evtwin`</span></code> (uses cmake)
or <code class="docutils literal notranslate"><span class="pre">`athena`</span></code> (downloads and patches code) for hints.</p>
</div>
<p>If you already have a make file, you might need to add the
<code class="docutils literal notranslate"><span class="pre">`libcodename.a`</span></code> target. You can define this target by
adding the following code to your make file at the appropriate
locations in the makefile.</p>
<dl class="docutils">
<dt>… code-block:: Makefile</dt>
<dd><p class="first">CODELIB = libcodename.a</p>
<p>CODEOBJS = …list of object files…</p>
<p>AR = ar ruv
RANLIB = ranlib</p>
<dl class="last docutils">
<dt>$(CODELIB): $(CODEOBJS)</dt>
<dd>$(RM) -f $&#64;
$(AR) $&#64; $(CODEOBJS)
$(RANLIB) $&#64;</dd>
</dl>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="legacy_code.html" class="btn btn-neutral float-right" title="Create an low-level Interface to a Code" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="fortran_code.html" class="btn btn-neutral float-left" title="Integrate a Fortran 90 code" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2009-2019 The AMUSE Team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
    <!-- Piwik -->
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://stats.amusecode.org/" : "http://stats.amusecode.org/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="http://stats.amusecode.org/piwik.php?idsite=1" style="border:0" alt="" /></p></noscript>
<!-- End Piwik Tracking Code -->

     


</body>
</html>
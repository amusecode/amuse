

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Setting values for grid boundaries &mdash; AMUSE 12.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Interactive tutorial" href="../interactive_tutorial/index.html" />
    <link rel="prev" title="Plotting with amuse" href="plot.html" />
     
    <link rel="stylesheet" href="../_static/default.css" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> AMUSE
          

          
          </a>

          
            
            
              <div class="version">
                12.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="units.html">Working with Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="units.html#quantities">Quantities</a></li>
<li class="toctree-l2"><a class="reference internal" href="units.html#working-with-arrays">Working with arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="most_massive_from_salpeter.html">Estimating the typical mass of the most massive star in a cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="particle_sets.html">Working with Particle Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="c_code.html">Integrate a C++ code</a></li>
<li class="toctree-l2"><a class="reference internal" href="fortran_code.html">Integrate a Fortran 90 code</a></li>
<li class="toctree-l2"><a class="reference internal" href="gravitational_dynamics_code.html">Adding a Gravitational Dynamics Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="legacy_code.html">Create an low-level Interface to a Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="blender.html">Using Blender for visualising Amuse results</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot.html">Plotting with amuse</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Setting values for grid boundaries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#supported-boundary-conditions">Supported boundary conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#custom-boundary-conditions">Custom boundary conditions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../interactive_tutorial/index.html">Interactive tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design/index.html">Design documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AMUSE</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Tutorials</a> &raquo;</li>
        
      <li>Setting values for grid boundaries</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorial/grid_boundary.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="setting-values-for-grid-boundaries">
<h1>Setting values for grid boundaries<a class="headerlink" href="#setting-values-for-grid-boundaries" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">At the time of writing of this tutorial (september 2012), only the
Athena and Capreole hydrodynamics codes support the user
defined boundaries.</p>
</div>
<p>In AMUSE, you can specify how a hydrodynamics grid code handles the
boundary conditions. Hydrodynamic grid codes define a number of
special grid cells at all ends of the grid. These cells are often
called boundary or ghost cells and are handled differently by the
code. The flow-variables in these cells are not evolved but
calculated from other cells or from a user defined function.</p>
<div class="section" id="supported-boundary-conditions">
<h2>Supported boundary conditions<a class="headerlink" href="#supported-boundary-conditions" title="Permalink to this headline">¶</a></h2>
<p>Each code in amuse will need to provide at least 3 kinds of boundary
conditions:</p>
<dl class="docutils">
<dt>periodic</dt>
<dd>To simulate periodically repeating problems. Periodic boundary
conditions simulates as if the grid is connected to a copy of
itself, often implemented by copying over the data at the
opposite site of the grid to the boundary cells.</dd>
<dt>reflect</dt>
<dd>Mirrors all grid variables in the boundary cells, often
implemented by copying the data of the cells connected to the
boundary into the boundary cells.</dd>
<dt>outflow</dt>
<dd>Sets the derivative of the flow variables with respect to the
direction of the boundary to zero.</dd>
</dl>
<p>The following picture shows all three boundary conditions for a one
dimensional grid with 4 boundary cells:</p>
<img alt="../_images/boundaries1.png" src="../_images/boundaries1.png" />
<p>Boundary conditions are defined by setting a boundary parameter for
each boundary of the grid of a code. These boundaries are defined:</p>
<dl class="docutils">
<dt>xbound1</dt>
<dd>The x-axis boundary on the left side of the grid, often called
the inflow boundary</dd>
<dt>xbound2</dt>
<dd>The x-axis boundary on the right side of the grid, often called
the outflow boundary</dd>
<dt>ybound1</dt>
<dd>The y-axis boundary on the bottom side of the grid, often called
the inflow boundary</dd>
<dt>ybound2</dt>
<dd>The y-axis boundary on the top side of the grid, often called
the outflow boundary</dd>
<dt>zbound1</dt>
<dd>The z-axis boundary on the front side of the grid, often called
the inflow boundary</dd>
<dt>zbound2</dt>
<dd>The z-axis boundary on the back side of the grid, often called
the outflow boundary</dd>
</dl>
<img alt="../_images/boundaries2.png" src="../_images/boundaries2.png" />
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">amuse.lab</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">code</span> <span class="o">=</span> <span class="n">Athena</span><span class="p">()</span>
<span class="n">code</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">xbound1</span> <span class="o">=</span> <span class="s2">&quot;periodic&quot;</span>
<span class="n">code</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">ybound1</span> <span class="o">=</span> <span class="s2">&quot;reflect&quot;</span>
</pre></div>
</div>
<p>You can also set the boundary per axis as an <code class="docutils literal notranslate"><span class="pre">(inflow,</span> <span class="pre">outflow)</span></code> parameter
with the <code class="docutils literal notranslate"><span class="pre">x_,</span> <span class="pre">y_,</span> <span class="pre">z_boundary_condition</span></code> parameters:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">amuse.lab</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">code</span> <span class="o">=</span> <span class="n">Athena</span><span class="p">()</span>

<span class="n">instance</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">x_boundary_conditions</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;periodic&quot;</span><span class="p">,</span><span class="s2">&quot;periodic&quot;</span><span class="p">)</span>
<span class="n">instance</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">y_boundary_conditions</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;periodic&quot;</span><span class="p">,</span><span class="s2">&quot;periodic&quot;</span><span class="p">)</span>
<span class="n">instance</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">z_boundary_conditions</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;periodic&quot;</span><span class="p">,</span><span class="s2">&quot;periodic&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-boundary-conditions">
<h2>Custom boundary conditions<a class="headerlink" href="#custom-boundary-conditions" title="Permalink to this headline">¶</a></h2>
<p>You can specify a custom boundary condition by setting the boundary
condition parameters to <code class="docutils literal notranslate"><span class="pre">interface</span></code>. After these parameters have
been set and committed you can change the boundary values by filling
in the correct boundary grid. These boundary grids do not overlap
but patch together to form a larger cuboid around the grid cuboid.
The x-boundary conditions have N boundary cells in the x direction
and the same amount of cells in the y and z direction as the grid.
The y-boundary conditions have N boundary cells in the y direction
and in the x direction it  has 2 * N + the number of cells in the x
direction of the grid, in the z direction it has the same amount of
cells as the grid. Finally the z-boundary conditions have N boundary
cells in the z direction and in the x and y directions it  has 2 * N
+ the number of cells in the x or y direction of the grid.</p>
<img alt="../_images/boundaries3.png" src="../_images/boundaries3.png" />
<p>You can get the boundary grid of a specific boundary by calling
<cite>get_boundary_grid</cite> on the code.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You fill the returned grid by copying over data from a memory
grid, as you can only set all attributes of the grid in one go
(you cannot set the individual attributes yet at we did not
implement the required methods, september 2012)</p>
</div>
<p>En example of filling the boundary grid:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">amuse.lab</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">instance</span><span class="o">=</span><span class="n">Athena</span><span class="p">()</span>
<span class="n">instance</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">mesh_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span> <span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">instance</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">mesh_length</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">|</span> <span class="n">generic_unit_system</span><span class="o">.</span><span class="n">length</span>
<span class="n">instance</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">x_boundary_conditions</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;interface&quot;</span><span class="p">,</span> <span class="s2">&quot;outflow&quot;</span><span class="p">)</span>

<span class="c1"># request the boundary grid</span>
<span class="c1"># it will have shape of 4 x 20 x 10 (x, y, z)</span>
<span class="c1"># as Athena has a 4 cell boundary depth</span>
<span class="n">xbound1_grid</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">get_boundary_grid</span><span class="p">(</span><span class="s1">&#39;xbound1&#39;</span><span class="p">)</span>

<span class="c1"># copy the grid to memory, so we can manipulate it easier</span>
<span class="n">memxbound1</span> <span class="o">=</span> <span class="n">xbound1_grid</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># just set all cells in the grid to the same values</span>
<span class="n">memxbound1</span><span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="mf">0.02</span> <span class="o">|</span> <span class="n">density</span>
<span class="n">memxbound1</span><span class="o">.</span><span class="n">rhovx</span> <span class="o">=</span> <span class="mf">0.2</span> <span class="o">|</span> <span class="n">momentum</span>
<span class="n">memxbound1</span><span class="o">.</span><span class="n">rhovy</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="o">|</span> <span class="n">momentum</span>
<span class="n">memxbound1</span><span class="o">.</span><span class="n">rhovz</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="o">|</span> <span class="n">momentum</span>
<span class="n">memxbound1</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span>  <span class="n">p</span> <span class="o">/</span> <span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">gamma</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">memxbound1</span><span class="o">.</span><span class="n">energy</span> <span class="o">+=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">memxbound1</span><span class="o">.</span><span class="n">rhovx</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
        <span class="n">memxbound1</span><span class="o">.</span><span class="n">rhovy</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span>
        <span class="n">memxbound1</span><span class="o">.</span><span class="n">rhovz</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="p">)</span> <span class="o">/</span> <span class="n">memxbound1</span><span class="o">.</span><span class="n">rho</span>

<span class="c1"># copy over the data so that the code has the correct</span>
<span class="c1"># boundary values</span>
<span class="n">channel</span> <span class="o">=</span> <span class="n">memxbound1</span><span class="o">.</span><span class="n">new_channel_to</span><span class="p">(</span><span class="n">xbound1_grid</span><span class="p">)</span>
<span class="n">channel</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
<p>A boundary grid connects to the grid in a very specific way. The
general rule for the <em>1</em> or <em>inflow</em> boundaries is that the last
cell of the boundary will connect to the first cell of the grid.
The general rule for the <em>2</em> or <em>outflow</em> boundaries is that the
first cell of the boundary will connect to the last cell of the grid.</p>
<p>For example for xbound1:</p>
<dl class="docutils">
<dt>xbound1</dt>
<dd>The left, inflow boundary on the x-axis. Will have cells <code class="docutils literal notranslate"><span class="pre">[0,</span>
<span class="pre">#</span> <span class="pre">boundary</span> <span class="pre">cells</span> <span class="pre">-</span> <span class="pre">1]</span></code> in the x direction. The last cell of
the boundary will connect to the first cell of the grid.</dd>
<dt>ybound1.</dt>
<dd>The right, outflow boundary on the x-axis. Will have cells
<code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">#</span> <span class="pre">boundary</span> <span class="pre">cells</span> <span class="pre">-</span> <span class="pre">1]</span></code> in the x direction. The first
cell of the boundary will connect to the last cell of the grid.</dd>
</dl>
<p>A boundary grid will have correct x, y and z positions that match the
grid. So, if a 1D grid starts at 0.0 and the cell size is 1.0,
the last grid cell on the left(the inflow boundary) will have position -0.5.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">amuse.lab</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">instance</span><span class="o">=</span><span class="n">Athena</span><span class="p">()</span>
<span class="n">instance</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">mesh_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">instance</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">mesh_length</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span> <span class="o">|</span> <span class="n">generic_unit_system</span><span class="o">.</span><span class="n">length</span>
<span class="n">instance</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">x_boundary_conditions</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;interface&quot;</span><span class="p">,</span> <span class="s2">&quot;interface&quot;</span><span class="p">)</span>

<span class="c1"># request the boundary grid on both sides</span>
<span class="c1"># it will have shape of 4 x 1 x 1 (x, y, z)</span>
<span class="c1"># as Athena has a 4 cell boundary depth</span>
<span class="n">xbound1_grid</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">get_boundary_grid</span><span class="p">(</span><span class="s1">&#39;xbound1&#39;</span><span class="p">)</span>
<span class="n">xbound2_grid</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">get_boundary_grid</span><span class="p">(</span><span class="s1">&#39;xbound2&#39;</span><span class="p">)</span>

<span class="k">print</span> <span class="n">xbound1_grid</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span>
<span class="k">print</span> <span class="n">instance</span><span class="o">.</span><span class="n">grid</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span>
<span class="k">print</span> <span class="n">xbound2_grid</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">x</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../interactive_tutorial/index.html" class="btn btn-neutral float-right" title="Interactive tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="plot.html" class="btn btn-neutral float-left" title="Plotting with amuse" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2009-2019 The AMUSE Team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
    <!-- Piwik -->
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://stats.amusecode.org/" : "http://stats.amusecode.org/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="http://stats.amusecode.org/piwik.php?idsite=1" style="border:0" alt="" /></p></noscript>
<!-- End Piwik Tracking Code -->

     


</body>
</html>
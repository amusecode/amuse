

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Stopping Conditions &mdash; AMUSE 12.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="From Codes to Data" href="from_codes_to_data.html" />
    <link rel="prev" title="Reporting during a run" href="report.html" />
     
    <link rel="stylesheet" href="../_static/default.css" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> AMUSE
          

          
          </a>

          
            
            
              <div class="version">
                12.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../interactive_tutorial/index.html">Interactive tutorial</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Reference documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="quantities_and_units.html">Quantities and Units</a></li>
<li class="toctree-l2"><a class="reference internal" href="particles.html">Datamodel</a></li>
<li class="toctree-l2"><a class="reference internal" href="particle_attributes.html">Particle Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="bridge.html">Bridge</a></li>
<li class="toctree-l2"><a class="reference internal" href="available-codes.html">Currently supported Community Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="core_support.html">Support code for AMUSE framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="legacy_support.html">Support code for the community code interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="fileformat.html">Supported File Formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="report.html">Reporting during a run</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Stopping Conditions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-stopping-conditions">Using stopping conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implementing-stopping-conditions">Implementing stopping conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-the-stopping-conditions-library">Using the stopping conditions library</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#stopping-condtions-with-parameters">Stopping condtions with parameters</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="from_codes_to_data.html">From Codes to Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="ioframework.html">Input / Output Framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="options.html">Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="directory-structure.html">Directory Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="incode_storage.html">Sets and Grids in Codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="cuda-setup.html">Setting up GPGPU with CUDA</a></li>
<li class="toctree-l2"><a class="reference internal" href="simplified_function_interface.html">Simplified interface function specification</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface_specification.html">Interface Specifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="message-protocol.html">Message protocol between python and community codes</a></li>
<li class="toctree-l2"><a class="reference internal" href="distributed.html">Distributed AMUSE</a></li>
<li class="toctree-l2"><a class="reference internal" href="cartesius.html">Running AMUSE on The Cartesius supercomputer</a></li>
<li class="toctree-l2"><a class="reference internal" href="style_guide.html">AMUSE Style Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="code_management.html">Source Code Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../design/index.html">Design documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">AMUSE</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Reference documentation</a> &raquo;</li>
        
      <li>Stopping Conditions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/reference/stopping_conditions.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="stopping-conditions">
<h1>Stopping Conditions<a class="headerlink" href="#stopping-conditions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Codes in AMUSE evolve their models in three loops, the “inner”, the
“outer” loop, and the “script” loop. The “inner” loop is controlled
by the code and evolves the model in a sufficiently small steps to
limit errors and be able to simulate important physics. The “outer”
loop invokes the “inner” loop until a condition is met specified by
the AMUSE script. The AMUSE script (or the “script” loop) interacts
with the “outer” loop.</p>
<blockquote>
<div><div class="graphviz"><img src="../_images/graphviz-18e1b48a57422f40add7c48265816e746892ae5a.png" alt="digraph layers0 {
  fontsize=10.0;
  node [fontsize=10.0,shape=box, style=filled, fillcolor=lightyellow, width=1.5];
  subgraph cluster0 {
  fontsize=10.0;
        style=filled;
        color=azure2;
        labeljust=&quot;l&quot;;
        label=&quot;AMUSE Script&quot;;
        &quot;script loop&quot;;
  }
  subgraph cluster1 {
  fontsize=10.0;
        style=filled;
        color=azure2;
        labeljust=&quot;l&quot;;
        label=&quot;Community Code&quot;;
        &quot;outer loop&quot;;
        &quot;inner loop&quot;;
  }
  &quot;script loop&quot; -&gt; &quot;outer loop&quot;[minlen=2];
  &quot;outer loop&quot; -&gt; &quot;inner loop&quot;;

  &quot;script loop&quot; -&gt; &quot;script loop&quot;  [dir=&quot;back&quot;, constraint=false,minlen=2, headport=&quot;se&quot;, tailport=&quot;ne&quot;];
  &quot;outer loop&quot; -&gt; &quot;outer loop&quot;[dir=&quot;back&quot;, constraint=false, headport=&quot;se&quot;, tailport=&quot;ne&quot;];
  &quot;inner loop&quot; -&gt; &quot;inner loop&quot;[dir=&quot;back&quot;, constraint=false, headport=&quot;se&quot;, tailport=&quot;ne&quot;];
}" class="graphviz" /></div>
</div></blockquote>
<p>In AMUSE the outer loop is always limited by the model time. Every
<code class="xref py py-func docutils literal notranslate"><span class="pre">evolve_model()</span></code> call has one argument, the model time. When the
simulation is about to go beyond this time (or is at this time),
control is returned to the caller.
This process is shown in the following code example.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// example outer loop</span>
<span class="kt">void</span> <span class="nf">outer_loop</span><span class="p">(</span><span class="kt">double</span> <span class="n">end_time</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">while</span><span class="p">(</span><span class="n">model_time</span> <span class="o">&lt;</span> <span class="n">end_time</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">...</span>
        <span class="n">inner_loop</span><span class="p">()</span>
        <span class="p">...</span>
        <span class="n">model_time</span> <span class="o">+=</span> <span class="n">delta_time_for_this_step</span>
    <span class="p">}</span>
    <span class="k">return</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The model time is often enough to control the loop but some
situations call for an earlier break in the loop when the model
time has not reached the end time. To be able to break the outer loop
before the end time is reached, the framework supports
<strong>stopping conditions</strong>. The following code example
shows how these conditions might work in a C code.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="c1">// example outer loop with stopping conditions</span>
<span class="kt">void</span> <span class="nf">outer_loop</span><span class="p">(</span><span class="kt">double</span> <span class="n">end_time</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">special_condition_was_met</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">while</span><span class="p">(</span><span class="n">model_time</span> <span class="o">&lt;</span> <span class="n">end_time</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">...</span>
        <span class="n">inner_loop</span><span class="p">()</span>
        <span class="p">...</span>
        <span class="n">check_if_special_conditions_are_met</span><span class="p">();</span>
        <span class="p">...</span>
        <span class="n">model_time</span> <span class="o">+=</span> <span class="n">delta_time_for_this_step</span>
        <span class="p">...</span>
        <span class="k">if</span><span class="p">(</span><span class="n">special_condition_was_met</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For example, a code might be able to detect a collision of two stars
and the user wants to handle this event. If the code would proceed
to the end time, the collision is long over and the user has no way
to know about the collision and cannot handle it.</p>
<img alt="../_images/stopping_conditions_collision.png" src="../_images/stopping_conditions_collision.png" />
<p>The <strong>stopping conditions</strong> framework in AMUSE provides
functionality for using and implementing stopping conditions. This
framework uses simple tables in the codes and translates these
tables to objects in the python scripts. In the next section the use
of this framework is described. In the final section the
implementation of the framework in a community code is described.</p>
</div>
<div class="section" id="using-stopping-conditions">
<h2>Using stopping conditions<a class="headerlink" href="#using-stopping-conditions" title="Permalink to this headline">¶</a></h2>
<p>All interaction with the <em>stopping conditions</em> of a <em>code</em>
is via the <code class="xref py py-attr docutils literal notranslate"><span class="pre">stopping_conditions</span></code> attribute of a <code class="xref py py-class docutils literal notranslate"><span class="pre">CodeInterface</span></code>
class. When the <code class="xref py py-attr docutils literal notranslate"><span class="pre">stopping_conditions</span></code> attribute is
queried it returns a <code class="xref py py-class docutils literal notranslate"><span class="pre">StoppingConditions</span></code> object. All
<code class="xref py py-class docutils literal notranslate"><span class="pre">StoppingConditions</span></code> objects have an attribute for each
stopping condition supported by AMUSE. The
attributes have the following names:</p>
<dl class="docutils">
<dt>collision_detection</dt>
<dd>The outer loop breaks when two stars connect</dd>
<dt>pair_detection</dt>
<dd>The outer loop breaks when two stars pair, possibly
creating a binary star.</dd>
<dt>escaper_detection</dt>
<dd>The outer loop breaks when a star escapes the
simulation (is no longer gravitationally bound
to the other stars)</dd>
<dt>timeout_detection</dt>
<dd>The outer loop breaks when a certain amount
of computer (wall-clock) time has elapsed.</dd>
<dt>number_of_steps_detection</dt>
<dd>The outer loop breaks when a certain amount
of steps (iterations) is reached.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="xref py py-class docutils literal notranslate"><span class="pre">CodeInterface</span></code> objects provide a object oriented
interface to each code.</p>
</div>
<p>All <code class="xref py py-class docutils literal notranslate"><span class="pre">StoppingConditions</span></code> objects provide a string
representation describing the supported conditions and their
states.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">amuse.lab</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">code</span> <span class="o">=</span> <span class="n">Hermite</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">code</span><span class="o">.</span><span class="n">stopping_conditions</span>
<span class="go">Stopping conditions of a &#39;Hermite&#39; object</span>
<span class="go">* supported conditions: collision_detection, pair_detection, timeout_detection</span>
<span class="go">* enabled conditions: none</span>
<span class="go">* set conditions: none</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">code</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
<p>For every attribute the user can determine if it is
supported, if it was enabled or if it was hit during
the <code class="xref py py-func docutils literal notranslate"><span class="pre">evolve()</span></code> loop.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">amuse.lab</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">code</span> <span class="o">=</span> <span class="n">Hermite</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">code</span><span class="o">.</span><span class="n">stopping_conditions</span><span class="o">.</span><span class="n">collision_detection</span><span class="o">.</span><span class="n">is_supported</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">code</span><span class="o">.</span><span class="n">stopping_conditions</span><span class="o">.</span><span class="n">collision_detection</span><span class="o">.</span><span class="n">is_enabled</span><span class="p">()</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">code</span><span class="o">.</span><span class="n">stopping_conditions</span><span class="o">.</span><span class="n">collision_detection</span><span class="o">.</span><span class="n">is_set</span><span class="p">()</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">code</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
<p>When a stopping condition was hit during the inner or outer loop
evaluation the user can query which particles were involved. The
particles involved are stored in columns. For pair wise detections
(collection and pair) the condition provides two columns. The first
column contains all the first particles of the pairs and the second
column contains all the second particles of the pairs. These columns
can be queried with the <code class="xref py py-meth docutils literal notranslate"><span class="pre">particles()</span></code> method on a stopping
condition attribute. This method takes one argument, the column
index and returns a particle subset with the involved particles.</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="38%" />
<col width="38%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Pair</th>
<th class="head">particles(0)</th>
<th class="head">particles(1)</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1 + 2</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>5 + 11</td>
<td>5</td>
<td>11</td>
</tr>
<tr class="row-even"><td>12 + 10</td>
<td>12</td>
<td>10</td>
</tr>
</tbody>
</table>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">amuse.lab</span> <span class="kn">import</span> <span class="o">*</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">code</span> <span class="o">=</span> <span class="n">Hermite</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sc</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">stopping_conditions</span><span class="o">.</span><span class="n">collision_detection</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sc</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">code</span><span class="o">.</span><span class="n">evolve_model</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">|</span> <span class="n">nbody_system</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">sc</span><span class="o">.</span><span class="n">is_set</span><span class="p">()</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">sc</span><span class="o">.</span><span class="n">particles</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pair</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">particles</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sc</span><span class="o">.</span><span class="n">particles</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">code</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="implementing-stopping-conditions">
<h2>Implementing stopping conditions<a class="headerlink" href="#implementing-stopping-conditions" title="Permalink to this headline">¶</a></h2>
<p>All codes supporting stopping conditions must implement the
<code class="xref py py-class docutils literal notranslate"><span class="pre">StoppingConditionInterface</span></code> interface. This can be easily
done by inheriting from the <code class="xref py py-class docutils literal notranslate"><span class="pre">StoppingConditionInterface</span></code> and
implementing all the functions defined in the interface:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyCodeInterface</span><span class="p">(</span><span class="n">CodeInterface</span><span class="p">,</span> <span class="n">StoppingConditionInterface</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>This <code class="xref py py-class docutils literal notranslate"><span class="pre">StoppingConditionInterface</span></code> interface models the interface to a
simple data model, best described as two tables:</p>
<dl class="docutils">
<dt>Defined stopping conditions table</dt>
<dd><p class="first">This table list the types of stopping conditions
and if these are supported by the code, and if so, if
these are enabled by the user.</p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="36%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">supported</th>
<th class="head">enabled</th>
</tr>
<tr class="row-even"><th class="head">int</th>
<th class="head">int
read only</th>
<th class="head">int
read/write</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-odd"><td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-even"><td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-even"><td>3</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
<dl class="last docutils">
<dt>type</dt>
<dd>The type of the stopping condition, integer between
0 and N. Defined by the framework</dd>
<dt>supported</dt>
<dd>1 if the stopping condition is supported, 0 otherwise.
Needs to be set by the implementer</dd>
<dt>enabled</dt>
<dd>1 if enabled by the user, 0 otherwise.
Implementer must provide a mechanism to set and unset
this field.</dd>
</dl>
</dd>
<dt>Set stopping conditions table</dt>
<dd><p class="first">This table has a row for each stopping condition
set during the outer and inner loop evaluations.
Every row lists the type of condition set and which
particles were involved (if any). The id of the
last particle in the list must be -1.</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="23%" />
<col width="23%" />
<col width="15%" />
<col width="26%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">type</th>
<th class="head">particle[0]</th>
<th class="head">particle(1)</th>
<th class="head">…</th>
<th class="head">particle(n)</th>
</tr>
<tr class="row-even"><th class="head">int</th>
<th class="head">int</th>
<th class="head">int</th>
<th class="head">int</th>
<th class="head">int</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-odd"><td>1</td>
<td>1</td>
<td>2</td>
<td>-1</td>
<td>-1</td>
</tr>
<tr class="row-even"><td>1</td>
<td>10</td>
<td>12</td>
<td>-1</td>
<td>-1</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>-1</td>
<td>…</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>1</td>
<td>11</td>
<td>20</td>
<td>…</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>…</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>3</td>
<td>-1</td>
<td>&#160;</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<dl class="last docutils">
<dt>type</dt>
<dd>The type of the stopping condition, integer between
0 and N. Defined by the framework. Set by the code</dd>
<dt>particle(0…n)</dt>
<dd>Index of the particle involved in the stopping condition.
The index of the last particle must be -1</dd>
</dl>
</dd>
</dl>
<dl class="class">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface">
<em class="property">class </em><code class="descclassname">amuse.support.codes.stopping_conditions.</code><code class="descname">StoppingConditionInterface</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface" title="Permalink to this definition">¶</a></dt>
<dd><dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.disable_stopping_condition">
<code class="descname">disable_stopping_condition</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.disable_stopping_condition" title="Permalink to this definition">¶</a></dt>
<dd><p>Will disable the stopping if it is supported</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">disable_stopping_condition</span><span class="p">(</span><span class="n">int32</span> <span class="n">type</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">disable_stopping_condition</span><span class="p">(</span><span class="k">type</span><span class="p">)</span>
  <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="k">type</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">disable_stopping_condition</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>type</strong> (<em>int32</em><em>, </em><em>IN</em>) – The index of the stopping condition</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">0 - OK
-1 - ERROR</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.enable_stopping_condition">
<code class="descname">enable_stopping_condition</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.enable_stopping_condition" title="Permalink to this definition">¶</a></dt>
<dd><p>Will enable the stopping if it is supported</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">enable_stopping_condition</span><span class="p">(</span><span class="n">int32</span> <span class="n">type</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">enable_stopping_condition</span><span class="p">(</span><span class="k">type</span><span class="p">)</span>
  <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="k">type</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">enable_stopping_condition</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>type</strong> (<em>int32</em><em>, </em><em>IN</em>) – The type index of the stopping condition</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">0 - OK
-1 - ERROR</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_number_of_stopping_conditions_set">
<code class="descname">get_number_of_stopping_conditions_set</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_number_of_stopping_conditions_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the number of stopping conditions set, one
condition can be set multiple times.</p>
<p>Stopping conditions are set when the code determines
that the conditions are met. The objects or information
about the condition can be retrieved with
the get_stopping_condition_info method.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">get_number_of_stopping_conditions_set</span><span class="p">(</span><span class="n">int32</span> <span class="o">*</span> <span class="n">result</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">get_number_of_stopping_conditions_set</span><span class="p">(</span><span class="k">result</span><span class="p">)</span>
  <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="k">result</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">get_number_of_stopping_conditions_set</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>result</strong> (<em>int32</em><em>, </em><em>OUT</em>) – &gt; 1 if any stopping condition is set</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">0 - OK
-1 - ERROR</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_stopping_condition_info">
<code class="descname">get_stopping_condition_info</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_stopping_condition_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Generic function for getting the information connected to
a stopping condition. Index can be between 0 and
the result of the <a href="#id1"><span class="problematic" id="id2">:method:`get_number_of_stopping_conditions_set`</span></a>
method.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">get_stopping_condition_info</span><span class="p">(</span><span class="n">int32</span> <span class="n">index</span><span class="p">,</span> <span class="n">int32</span> <span class="o">*</span> <span class="n">type</span><span class="p">,</span> 
  <span class="n">int32</span> <span class="o">*</span> <span class="n">number_of_particles</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">get_stopping_condition_info</span><span class="p">(</span><span class="nb">index</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span> <span class="n">number_of_particles</span><span class="p">)</span>
  <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="nb">index</span><span class="p">,</span> <span class="k">type</span><span class="p">,</span> <span class="n">number_of_particles</span>
  <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">get_stopping_condition_info</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>index</strong> (<em>int32</em><em>, </em><em>IN</em>) – Index in the array[0,number_of_stopping_conditions_set&gt;</li>
<li><strong>type</strong> (<em>int32</em><em>, </em><em>OUT</em>) – Kind of the condition, can be used to retrieve specific information</li>
<li><strong>number_of_particles</strong> (<em>int32</em><em>, </em><em>OUT</em>) – Number of particles that met this condition</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">0 - OK
-1 - ERROR</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_stopping_condition_maximum_density_parameter">
<code class="descname">get_stopping_condition_maximum_density_parameter</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_stopping_condition_maximum_density_parameter" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">get_stopping_condition_maximum_density_parameter</span><span class="p">(</span><span class="n">float64</span> <span class="o">*</span> <span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">get_stopping_condition_maximum_density_parameter</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
  <span class="kt">DOUBLE PRECISION</span> <span class="kd">::</span> <span class="k">value</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">get_stopping_condition_maximum_density_parameter</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> (<em>float64</em><em>, </em><em>OUT</em>) – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_stopping_condition_maximum_internal_energy_parameter">
<code class="descname">get_stopping_condition_maximum_internal_energy_parameter</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_stopping_condition_maximum_internal_energy_parameter" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">get_stopping_condition_maximum_internal_energy_parameter</span><span class="p">(</span>
  <span class="n">float64</span> <span class="o">*</span> <span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">get_stopping_condition_maximum_internal_energy_parameter</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
  <span class="kt">DOUBLE PRECISION</span> <span class="kd">::</span> <span class="k">value</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">get_stopping_condition_maximum_internal_energy_parameter</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> (<em>float64</em><em>, </em><em>OUT</em>) – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_stopping_condition_minimum_density_parameter">
<code class="descname">get_stopping_condition_minimum_density_parameter</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_stopping_condition_minimum_density_parameter" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">get_stopping_condition_minimum_density_parameter</span><span class="p">(</span><span class="n">float64</span> <span class="o">*</span> <span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">get_stopping_condition_minimum_density_parameter</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
  <span class="kt">DOUBLE PRECISION</span> <span class="kd">::</span> <span class="k">value</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">get_stopping_condition_minimum_density_parameter</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> (<em>float64</em><em>, </em><em>OUT</em>) – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_stopping_condition_minimum_internal_energy_parameter">
<code class="descname">get_stopping_condition_minimum_internal_energy_parameter</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_stopping_condition_minimum_internal_energy_parameter" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">get_stopping_condition_minimum_internal_energy_parameter</span><span class="p">(</span>
  <span class="n">float64</span> <span class="o">*</span> <span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">get_stopping_condition_minimum_internal_energy_parameter</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
  <span class="kt">DOUBLE PRECISION</span> <span class="kd">::</span> <span class="k">value</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">get_stopping_condition_minimum_internal_energy_parameter</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> (<em>float64</em><em>, </em><em>OUT</em>) – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_stopping_condition_number_of_steps_parameter">
<code class="descname">get_stopping_condition_number_of_steps_parameter</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_stopping_condition_number_of_steps_parameter" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieve max inner loop evaluations.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">get_stopping_condition_number_of_steps_parameter</span><span class="p">(</span><span class="n">int32</span> <span class="o">*</span> <span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">get_stopping_condition_number_of_steps_parameter</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
  <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="k">value</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">get_stopping_condition_number_of_steps_parameter</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> (<em>int32</em><em>, </em><em>OUT</em>) – Current number of avaible inner loop evaluations</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">0 - OK
-1 - ERROR</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_stopping_condition_out_of_box_parameter">
<code class="descname">get_stopping_condition_out_of_box_parameter</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_stopping_condition_out_of_box_parameter" title="Permalink to this definition">¶</a></dt>
<dd><p>Get size of box</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">get_stopping_condition_out_of_box_parameter</span><span class="p">(</span><span class="n">float64</span> <span class="o">*</span> <span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">get_stopping_condition_out_of_box_parameter</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
  <span class="kt">DOUBLE PRECISION</span> <span class="kd">::</span> <span class="k">value</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">get_stopping_condition_out_of_box_parameter</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> (<em>float64</em><em>, </em><em>OUT</em>) – Size of box</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">0 - OK
-1 - Value out of range</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_stopping_condition_out_of_box_use_center_of_mass_parameter">
<code class="descname">get_stopping_condition_out_of_box_use_center_of_mass_parameter</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_stopping_condition_out_of_box_use_center_of_mass_parameter" title="Permalink to this definition">¶</a></dt>
<dd><p>If True use the center of mass to determine the location of the box, if False use (0,0,0)</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">get_stopping_condition_out_of_box_use_center_of_mass_parameter</span><span class="p">(</span>
  <span class="kt">_Bool</span> <span class="o">*</span> <span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">get_stopping_condition_out_of_box_use_center_of_mass_parameter</span><span class="p">(</span> <span class="p">&amp;</span>
    <span class="k">value</span><span class="p">)</span>
  <span class="kt">LOGICAL</span> <span class="kd">::</span> <span class="k">value</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">get_stopping_condition_out_of_box_use_center_of_mass_parameter</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> (<em>bool</em><em>, </em><em>OUT</em>) – True if detection should use center of mass</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">0 - OK
-1 - Value out of range</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_stopping_condition_particle_index">
<code class="descname">get_stopping_condition_particle_index</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_stopping_condition_particle_index" title="Permalink to this definition">¶</a></dt>
<dd><p>For collision detection</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">get_stopping_condition_particle_index</span><span class="p">(</span><span class="n">int32</span> <span class="n">index</span><span class="p">,</span> 
  <span class="n">int32</span> <span class="n">index_of_the_column</span><span class="p">,</span> <span class="n">int32</span> <span class="o">*</span> <span class="n">index_of_particle</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">get_stopping_condition_particle_index</span><span class="p">(</span><span class="nb">index</span><span class="p">,</span>  <span class="p">&amp;</span>
    <span class="n">index_of_the_column</span><span class="p">,</span> <span class="n">index_of_particle</span><span class="p">)</span>
  <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="nb">index</span><span class="p">,</span> <span class="n">index_of_the_column</span><span class="p">,</span> <span class="n">index_of_particle</span>
  <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">get_stopping_condition_particle_index</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>index</strong> (<em>int32</em><em>, </em><em>IN</em>) – Index in the array[0,number_of_stopping_conditions_set&gt;</li>
<li><strong>index_of_the_column</strong> (<em>int32</em><em>, </em><em>IN</em>) – Column index involved in the condition (for pair collisons 0 and 1 are possible)</li>
<li><strong>index_of_particle</strong> (<em>int32</em><em>, </em><em>OUT</em>) – Set to the identifier of particle[index_of_the_column][index]</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">0 - OK
-1 - ERROR</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_stopping_condition_timeout_parameter">
<code class="descname">get_stopping_condition_timeout_parameter</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.get_stopping_condition_timeout_parameter" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieve max computer time available (in seconds).</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">get_stopping_condition_timeout_parameter</span><span class="p">(</span><span class="n">float64</span> <span class="o">*</span> <span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">get_stopping_condition_timeout_parameter</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
  <span class="kt">DOUBLE PRECISION</span> <span class="kd">::</span> <span class="k">value</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">get_stopping_condition_timeout_parameter</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> (<em>float64</em><em>, </em><em>OUT</em>) – Current value of avaible wallclock time in seconds</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">0 - OK
-1 - ERROR</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.has_stopping_condition">
<code class="descname">has_stopping_condition</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.has_stopping_condition" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if the stopping condition with
the given index is supported by the code,
0 otherwise.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">has_stopping_condition</span><span class="p">(</span><span class="n">int32</span> <span class="n">type</span><span class="p">,</span> <span class="n">int32</span> <span class="o">*</span> <span class="n">result</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">has_stopping_condition</span><span class="p">(</span><span class="k">type</span><span class="p">,</span> <span class="k">result</span><span class="p">)</span>
  <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="k">type</span><span class="p">,</span> <span class="k">result</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">has_stopping_condition</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>type</strong> (<em>int32</em><em>, </em><em>IN</em>) – The type index  of the stopping condition</li>
<li><strong>result</strong> (<em>int32</em><em>, </em><em>OUT</em>) – 1 if the stopping condition is supported</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">0 - OK
-1 - ERROR</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.is_stopping_condition_enabled">
<code class="descname">is_stopping_condition_enabled</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.is_stopping_condition_enabled" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if the stopping condition with
the given index is enabled,0 otherwise.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">is_stopping_condition_enabled</span><span class="p">(</span><span class="n">int32</span> <span class="n">type</span><span class="p">,</span> <span class="n">int32</span> <span class="o">*</span> <span class="n">result</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">is_stopping_condition_enabled</span><span class="p">(</span><span class="k">type</span><span class="p">,</span> <span class="k">result</span><span class="p">)</span>
  <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="k">type</span><span class="p">,</span> <span class="k">result</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">is_stopping_condition_enabled</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>type</strong> (<em>int32</em><em>, </em><em>IN</em>) – The index of the stopping condition</li>
<li><strong>result</strong> (<em>int32</em><em>, </em><em>OUT</em>) – 1 if the stopping condition is enabled</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">0 - OK
-1 - ERROR</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.is_stopping_condition_set">
<code class="descname">is_stopping_condition_set</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.is_stopping_condition_set" title="Permalink to this definition">¶</a></dt>
<dd><p>Return 1 if the stopping condition with
the given index is enabled,0 otherwise.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">is_stopping_condition_set</span><span class="p">(</span><span class="n">int32</span> <span class="n">type</span><span class="p">,</span> <span class="n">int32</span> <span class="o">*</span> <span class="n">result</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">is_stopping_condition_set</span><span class="p">(</span><span class="k">type</span><span class="p">,</span> <span class="k">result</span><span class="p">)</span>
  <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="k">type</span><span class="p">,</span> <span class="k">result</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">is_stopping_condition_set</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>type</strong> (<em>int32</em><em>, </em><em>IN</em>) – The index of the stopping condition</li>
<li><strong>result</strong> (<em>int32</em><em>, </em><em>OUT</em>) – 1 if the stopping condition is enabled</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">0 - OK
-1 - ERROR</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.set_stopping_condition_maximum_density_parameter">
<code class="descname">set_stopping_condition_maximum_density_parameter</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.set_stopping_condition_maximum_density_parameter" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">set_stopping_condition_maximum_density_parameter</span><span class="p">(</span><span class="n">float64</span> <span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">set_stopping_condition_maximum_density_parameter</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
  <span class="kt">DOUBLE PRECISION</span> <span class="kd">::</span> <span class="k">value</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">set_stopping_condition_maximum_density_parameter</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> (<em>float64</em><em>, </em><em>IN</em>) – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.set_stopping_condition_maximum_internal_energy_parameter">
<code class="descname">set_stopping_condition_maximum_internal_energy_parameter</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.set_stopping_condition_maximum_internal_energy_parameter" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">set_stopping_condition_maximum_internal_energy_parameter</span><span class="p">(</span>
  <span class="n">float64</span> <span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">set_stopping_condition_maximum_internal_energy_parameter</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
  <span class="kt">DOUBLE PRECISION</span> <span class="kd">::</span> <span class="k">value</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">set_stopping_condition_maximum_internal_energy_parameter</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> (<em>float64</em><em>, </em><em>IN</em>) – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.set_stopping_condition_minimum_density_parameter">
<code class="descname">set_stopping_condition_minimum_density_parameter</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.set_stopping_condition_minimum_density_parameter" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">set_stopping_condition_minimum_density_parameter</span><span class="p">(</span><span class="n">float64</span> <span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">set_stopping_condition_minimum_density_parameter</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
  <span class="kt">DOUBLE PRECISION</span> <span class="kd">::</span> <span class="k">value</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">set_stopping_condition_minimum_density_parameter</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> (<em>float64</em><em>, </em><em>IN</em>) – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.set_stopping_condition_minimum_internal_energy_parameter">
<code class="descname">set_stopping_condition_minimum_internal_energy_parameter</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.set_stopping_condition_minimum_internal_energy_parameter" title="Permalink to this definition">¶</a></dt>
<dd><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">set_stopping_condition_minimum_internal_energy_parameter</span><span class="p">(</span>
  <span class="n">float64</span> <span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">set_stopping_condition_minimum_internal_energy_parameter</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
  <span class="kt">DOUBLE PRECISION</span> <span class="kd">::</span> <span class="k">value</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">set_stopping_condition_minimum_internal_energy_parameter</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> (<em>float64</em><em>, </em><em>IN</em>) – </td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.set_stopping_condition_number_of_steps_parameter">
<code class="descname">set_stopping_condition_number_of_steps_parameter</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.set_stopping_condition_number_of_steps_parameter" title="Permalink to this definition">¶</a></dt>
<dd><p>Set max inner loop evaluations.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">set_stopping_condition_number_of_steps_parameter</span><span class="p">(</span><span class="n">int32</span> <span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">set_stopping_condition_number_of_steps_parameter</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
  <span class="kt">INTEGER</span> <span class="kd">::</span> <span class="k">value</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">set_stopping_condition_number_of_steps_parameter</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> (<em>int32</em><em>, </em><em>IN</em>) – Available inner loop evaluations</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">0 - OK
-1 - Value out of range</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.set_stopping_condition_out_of_box_parameter">
<code class="descname">set_stopping_condition_out_of_box_parameter</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.set_stopping_condition_out_of_box_parameter" title="Permalink to this definition">¶</a></dt>
<dd><p>Set size of box.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">set_stopping_condition_out_of_box_parameter</span><span class="p">(</span><span class="n">float64</span> <span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">set_stopping_condition_out_of_box_parameter</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
  <span class="kt">DOUBLE PRECISION</span> <span class="kd">::</span> <span class="k">value</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">set_stopping_condition_out_of_box_parameter</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> (<em>float64</em><em>, </em><em>IN</em>) – Size of box</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">0 - OK
-1 - Value out of range</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.set_stopping_condition_out_of_box_use_center_of_mass_parameter">
<code class="descname">set_stopping_condition_out_of_box_use_center_of_mass_parameter</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.set_stopping_condition_out_of_box_use_center_of_mass_parameter" title="Permalink to this definition">¶</a></dt>
<dd><p>If True use the center of mass to determine the location of the box, if False use (0,0,0)</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">set_stopping_condition_out_of_box_use_center_of_mass_parameter</span><span class="p">(</span>
  <span class="kt">_Bool</span> <span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">set_stopping_condition_out_of_box_use_center_of_mass_parameter</span><span class="p">(</span> <span class="p">&amp;</span>
    <span class="k">value</span><span class="p">)</span>
  <span class="kt">LOGICAL</span> <span class="kd">::</span> <span class="k">value</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">set_stopping_condition_out_of_box_use_center_of_mass_parameter</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> (<em>bool</em><em>, </em><em>IN</em>) – True if detection should use center of mass</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">0 - OK
-1 - Value out of range</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="amuse.support.codes.stopping_conditions.StoppingConditionInterface.set_stopping_condition_timeout_parameter">
<code class="descname">set_stopping_condition_timeout_parameter</code><a class="headerlink" href="#amuse.support.codes.stopping_conditions.StoppingConditionInterface.set_stopping_condition_timeout_parameter" title="Permalink to this definition">¶</a></dt>
<dd><p>Set max computer time available (in seconds).</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">int32</span> <span class="nf">set_stopping_condition_timeout_parameter</span><span class="p">(</span><span class="n">float64</span> <span class="n">value</span><span class="p">);</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">FUNCTION </span><span class="n">set_stopping_condition_timeout_parameter</span><span class="p">(</span><span class="k">value</span><span class="p">)</span>
  <span class="kt">DOUBLE PRECISION</span> <span class="kd">::</span> <span class="k">value</span>
<span class="k">  </span><span class="kt">INTEGER</span> <span class="kd">::</span> <span class="n">set_stopping_condition_timeout_parameter</span>
<span class="k">END FUNCTION</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>value</strong> (<em>float64</em><em>, </em><em>IN</em>) – Available wallclock time in seconds</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">0 - OK
-1 - Value out of range</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<p>This interface contains a lot of functions and implementing it
might be a time consuming task. To help implementing the
interface, AMUSE provides a C library that does most of the
table management, this library is described in the next section.</p>
</div>
<div class="section" id="using-the-stopping-conditions-library">
<h2>Using the stopping conditions library<a class="headerlink" href="#using-the-stopping-conditions-library" title="Permalink to this headline">¶</a></h2>
<p>The stopping conditions tables are implemented as a
static C library. This library is part of the AMUSE distribution
and can be found in the <code class="docutils literal notranslate"><span class="pre">`lib/stopcond`</span></code> directory.</p>
<p>The library implements <em>all</em> functions of the <code class="xref py py-class docutils literal notranslate"><span class="pre">StoppingConditionInterface</span></code>
interface and provides a number functions for the
code implementer to actually set and support
stopping conditions. The library does not implement any
stopping condition detection routines. These have to
be implemented on a per code basis. The functionality
of the library is limited to managing the stopping conditions
tables and the library has to be controlled by the code
so that stopping conditions are set.</p>
<p>The library implements the defined stopping conditions table as
three long integers. These integers are used as bitmaps (the state
of individual bits is used to determine if a condition is true or
false). The individual bits can be tested with the following
macros:</p>
<dl class="data">
<dt id="COLLISION_DETECTION_BITMAP">
<code class="descname">COLLISION_DETECTION_BITMAP</code><a class="headerlink" href="#COLLISION_DETECTION_BITMAP" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="data">
<dt id="PAIR_DETECTION_BITMAP">
<code class="descname">PAIR_DETECTION_BITMAP</code><a class="headerlink" href="#PAIR_DETECTION_BITMAP" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="data">
<dt id="ESCAPER_DETECTION_BITMAP">
<code class="descname">ESCAPER_DETECTION_BITMAP</code><a class="headerlink" href="#ESCAPER_DETECTION_BITMAP" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="data">
<dt id="TIMEOUT_DETECTION_BITMAP">
<code class="descname">TIMEOUT_DETECTION_BITMAP</code><a class="headerlink" href="#TIMEOUT_DETECTION_BITMAP" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="data">
<dt id="NUMBER_OF_STEPS_BITMAP">
<code class="descname">NUMBER_OF_STEPS_BITMAP</code><a class="headerlink" href="#NUMBER_OF_STEPS_BITMAP" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The three variables are not accessible directly from FORTRAN
codes. The stopping condition library has special functions
for FORTRAN to access them.</p>
<p>The three global variables are:</p>
<dl class="var">
<dt id="c.enabled_conditions">
long <code class="descname">enabled_conditions</code><a class="headerlink" href="#c.enabled_conditions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Individual bits are set when the user enables a stopping condition.
Access in FORTRAN through:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">INCLUDE</span> <span class="s2">&quot;../../lib/stopcond/stopcond.inc&quot;</span>
<span class="kt">INTEGER</span><span class="kd">::</span> <span class="n">is_stopping_condition_enabled</span>
<span class="kt">INTEGER</span><span class="kd">::</span> <span class="n">is_collision_detection_enabled</span>
<span class="kt">INTEGER</span><span class="kd">::</span> <span class="n">error</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">is_stopping_condition_enabled</span><span class="p">(</span><span class="n">COLLISION_DETECTION</span><span class="p">,</span> <span class="n">is_collision_detection_enabled</span><span class="p">)</span>
</pre></div>
</div>
<dl class="var">
<dt id="c.set_conditions">
long <code class="descname">set_conditions</code><a class="headerlink" href="#c.set_conditions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Individual bits are set when a condition is detected by the
code. (the <a class="reference internal" href="#c.set_stopping_condition_info" title="set_stopping_condition_info"><code class="xref c c-func docutils literal notranslate"><span class="pre">set_stopping_condition_info()</span></code></a> will fill
this bitmap). Access in FORTRAN:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">INCLUDE</span> <span class="s2">&quot;../../lib/stopcond/stopcond.inc&quot;</span>
<span class="kt">INTEGER</span><span class="kd">::</span> <span class="n">is_stopping_condition_set</span>
<span class="kt">INTEGER</span><span class="kd">::</span> <span class="n">is_collision_detection_set</span>
<span class="kt">INTEGER</span><span class="kd">::</span> <span class="n">error</span>
<span class="n">error</span> <span class="o">=</span> <span class="n">is_stopping_condition_set</span><span class="p">(</span><span class="n">COLLISION_DETECTION</span><span class="p">,</span> <span class="n">is_collision_detection_set</span><span class="p">)</span>
</pre></div>
</div>
<dl class="var">
<dt id="c.supported_conditions">
long <code class="descname">supported_conditions</code><a class="headerlink" href="#c.supported_conditions" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="n">set_supported_conditions</span><span class="p">()</span>
</pre></div>
</div>
<p>Individual bits are set for supported conditions. This global
must be defined by the code.</p>
<p>For a code that support
collision detection and timeout detection the variable can
be defined in c as:</p>
<blockquote>
<div><div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">set_support_for_condition</span><span class="p">(</span><span class="n">COLLISION_DETECTION</span><span class="p">);</span>
<span class="n">set_support_for_condition</span><span class="p">(</span><span class="n">PAIR_DETECTION</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
<dl class="docutils">
<dt>or in FORTRAN as:</dt>
<dd><div class="first last highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">INCLUDE</span> <span class="s2">&quot;../../lib/stopcond/stopcond.inc&quot;</span>

<span class="n">set_support_for_condition</span><span class="p">(</span><span class="n">COLLISION_DETECTION</span><span class="p">)</span>
<span class="n">set_support_for_condition</span><span class="p">(</span><span class="n">PAIR_DETECTION</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p>To refer to the type of a stopping condition, the library defines the
following macros:</p>
<dl class="data">
<dt id="COLLISION_DETECTION">
<code class="descname">COLLISION_DETECTION</code><a class="headerlink" href="#COLLISION_DETECTION" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="data">
<dt id="PAIR_DETECTION">
<code class="descname">PAIR_DETECTION</code><a class="headerlink" href="#PAIR_DETECTION" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="data">
<dt id="ESCAPER_DETECTION">
<code class="descname">ESCAPER_DETECTION</code><a class="headerlink" href="#ESCAPER_DETECTION" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="data">
<dt id="TIMEOUT_DETECTION">
<code class="descname">TIMEOUT_DETECTION</code><a class="headerlink" href="#TIMEOUT_DETECTION" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="data">
<dt id="NUMBER_OF_STEPS_DETECTION">
<code class="descname">NUMBER_OF_STEPS_DETECTION</code><a class="headerlink" href="#NUMBER_OF_STEPS_DETECTION" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The following four functions can be used to set and reset
the stopping conditions.</p>
<dl class="function">
<dt id="c.reset_stopping_conditions">
int <code class="descname">reset_stopping_conditions</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#c.reset_stopping_conditions" title="Permalink to this definition">¶</a></dt>
<dd><p>Resets all stopping conditions. Needs to be called just
before entering the outer_loop</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="nf">outer_loop</span><span class="p">(</span><span class="kt">double</span> <span class="n">end_time</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">reset_stopping_conditions</span><span class="p">()</span>
    <span class="k">while</span><span class="p">(</span><span class="n">model_time</span> <span class="o">&lt;</span> <span class="n">end_time</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="p">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="c.next_index_for_stopping_condition">
int <code class="descname">next_index_for_stopping_condition</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#c.next_index_for_stopping_condition" title="Permalink to this definition">¶</a></dt>
<dd><p>Reserves a row on the stopping conditions table.
Needs to be called after detecting a stopping condition so
that the code can fill in the stopping condition information.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">if</span><span class="p">(</span><span class="n">COLLISION_DETECTION_BITMAP</span> <span class="o">&amp;</span> <span class="n">enabled_conditions</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">row</span> <span class="o">=</span> <span class="n">next_index_for_stopping_condition</span><span class="p">();</span>
    <span class="n">set_stopping_condition_info</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">COLLISION_DETECTION</span><span class="p">);</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="c.set_stopping_condition_info">
int <code class="descname">set_stopping_condition_info</code><span class="sig-paren">(</span>int<em>&nbsp;index</em>, int<em>&nbsp;type</em><span class="sig-paren">)</span><a class="headerlink" href="#c.set_stopping_condition_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the type of stopping condition encountered for
the given row index. Use one of the predefined type macros
for the type argument</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">set_stopping_condition_info</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">COLLISION_DETECTION</span><span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="c.set_stopping_condition_particle_index">
int <code class="descname">set_stopping_condition_particle_index</code><span class="sig-paren">(</span>int<em>&nbsp;index</em>, int<em>&nbsp;column_index</em>, int<em>&nbsp;index_of_particle</em><span class="sig-paren">)</span><a class="headerlink" href="#c.set_stopping_condition_particle_index" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the id of a particles involved in the stopping
condition (only needed for stopping conditions with particles)</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">set_stopping_condition_info</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">COLLISION_DETECTION</span><span class="p">);</span>
<span class="n">set_stopping_condition_particle_index</span><span class="p">(</span><span class="n">stopping_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ident</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="n">set_stopping_condition_particle_index</span><span class="p">(</span><span class="n">stopping_index</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ident</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
</pre></div>
</div>
</dd></dl>

<div class="section" id="stopping-condtions-with-parameters">
<h3>Stopping condtions with parameters<a class="headerlink" href="#stopping-condtions-with-parameters" title="Permalink to this headline">¶</a></h3>
<p>The <em>timeout</em> and <em>number of steps</em> stopping conditions are parameter
based, i.e. the conditions are met if the outer loop took a certain time
or a reached a certain number of steps (iterations). The parameters are
accessed through the following procedures:</p>
<dl class="function">
<dt>
<code class="descname">int set_stopping_condition_timeout_parameter(double value);</code></dt>
<dd><p>Sets the computer (wall-clock) time parameter.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">get_stopping_condition_timeout_parameter(double *value);</code></dt>
<dd><p>Gets the computer (wall-clock) time parameter.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">int set_stopping_condition_number_of_steps_parameter(int value);</code></dt>
<dd><p>Sets the number of steps parameter.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">int get_stopping_condition_number_of_steps_parameter(int *value);</code></dt>
<dd><p>Gets the number of steps parameter.</p>
</dd></dl>

<p>For MPI enabled codes, the stopping conditions must be distributed
and collected. The following three functions can be used to
manage the MPI communication.</p>
<dl class="function">
<dt id="c.mpi_setup_stopping_conditions">
int <code class="descname">mpi_setup_stopping_conditions</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#c.mpi_setup_stopping_conditions" title="Permalink to this definition">¶</a></dt>
<dd><p>Setups some globals for MPI communication, this needs
to be called once per code execution (for example
in a <code class="xref py py-func docutils literal notranslate"><span class="pre">initialize_code()</span></code> function)</p>
</dd></dl>

<dl class="function">
<dt id="c.mpi_distribute_stopping_conditions">
int <code class="descname">mpi_distribute_stopping_conditions</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#c.mpi_distribute_stopping_conditions" title="Permalink to this definition">¶</a></dt>
<dd><p>Distributes the state of the conditions, so each process
knows which conditions are enabled by the user. Needs
to be called when the parallel code is entered (and all
other data is distributed).</p>
</dd></dl>

<dl class="function">
<dt id="c.mpi_collect_stopping_conditions">
int <code class="descname">mpi_collect_stopping_conditions</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#c.mpi_collect_stopping_conditions" title="Permalink to this definition">¶</a></dt>
<dd><p>Collects the individual tables of the set conditions and
combines these to one table on the root process (MPI rank
== 0). Needs to be called at the end of the parallel part
of the code.</p>
</dd></dl>

<p>The procedure for adding stopping conditions is explained by
the following steps.</p>
<ol class="arabic">
<li><p class="first">Add compiler and linker flags to the build script or
Makefile.</p>
<p>To use the <code class="docutils literal notranslate"><span class="pre">`stopcond`</span></code> library, the compile and link steps
of the community code must be changed. The following compiler flags
need to be added:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>-I$(AMUSE_DIR)/lib/stopcond
</pre></div>
</div>
<p>For the link step the following linker flags are needed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>-L$(AMUSE_DIR)/lib/stopcond -lstopcondmpi
</pre></div>
</div>
</li>
<li><p class="first">Include the header file and defining the globals</p>
<p>The name of the header file is “stopcond.h” and
this header file needs to be included in all
files referring to the stopping conditions.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stopcond.h&gt;</span><span class="cp"></span>
</pre></div>
</div>
<p>The code should take care of the setting
of the <a class="reference internal" href="#c.supported_conditions" title="supported_conditions"><code class="xref c c-data docutils literal notranslate"><span class="pre">supported_conditions</span></code></a> bitmap
in its initialization, e.g.:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">set_support_for_condition</span><span class="p">(</span><span class="n">COLLISION_DETECTION</span><span class="p">);</span>
<span class="n">set_support_for_condition</span><span class="p">(</span><span class="n">PAIR_DETECTION</span><span class="p">);</span>
</pre></div>
</div>
<p>In FORTRAN include “stopcond.inc” in subroutines that
require the constants.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">INCLUDE</span> <span class="s2">&quot;../../lib/stopcond/stopcond.inc&quot;</span>
<span class="n">set_support_for_condition</span><span class="p">(</span><span class="n">COLLISION_DETECTION</span><span class="p">)</span>
<span class="n">set_support_for_condition</span><span class="p">(</span><span class="n">PAIR_DETECTION</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Check for a condition when it is enabled and set the condition
if found. In c:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int</span> <span class="n">is_collision_detection_enabled</span><span class="p">;</span>
<span class="n">is_stopping_condition_enabled</span><span class="p">(</span><span class="n">COLLISION_DETECTION</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">is_collision_detection_enabled</span><span class="p">);</span>

<span class="k">if</span><span class="p">(</span><span class="n">is_collision_detection_enabled</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">real</span> <span class="n">sum_of_the_radii</span> <span class="o">=</span> <span class="n">radius_of_star</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">radius_of_star</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">distance_between_stars</span> <span class="o">&lt;=</span> <span class="n">sum_of_the_radii</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">stopping_index</span>  <span class="o">=</span> <span class="n">next_index_for_stopping_condition</span><span class="p">();</span>
        <span class="n">set_stopping_condition_info</span><span class="p">(</span><span class="n">stopping_index</span><span class="p">,</span> <span class="n">COLLISION_DETECTION</span><span class="p">);</span>
        <span class="n">set_stopping_condition_particle_index</span><span class="p">(</span>
            <span class="n">stopping_index</span><span class="p">,</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="n">identifier_of_star</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="p">);</span>
        <span class="n">set_stopping_condition_particle_index</span><span class="p">(</span>
            <span class="n">stopping_index</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="n">identifier_of_star</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and in FORTRAN:</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">INCLUDE</span> <span class="s2">&quot;../../lib/stopcond/stopcond.inc&quot;</span>
<span class="kt">INTEGER</span><span class="kd">::</span><span class="n">is_stopping_conditions_enabled</span>
<span class="kt">INTEGER</span><span class="kd">::</span><span class="n">is_collision_detection_enabled</span><span class="p">,</span> <span class="n">stopping_index</span>
<span class="kt">INTEGER</span><span class="kd">::</span><span class="n">error</span>

<span class="n">error</span> <span class="o">=</span> <span class="n">is_stopping_condition_enabled</span><span class="p">(</span><span class="n">COLLISION_DETECTION</span><span class="p">,</span> <span class="n">is_collision_detection_enabled</span><span class="p">)</span>
<span class="c">!...</span>
<span class="k">IF </span><span class="n">is_collision_detection_enabled</span><span class="p">.</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span> <span class="k">THEN</span>
<span class="k">  IF </span><span class="n">there_is_a_collision</span> <span class="k">THEN</span>
<span class="k">    </span><span class="n">stopping_index</span> <span class="o">=</span> <span class="n">next_index_for_stopping_conditions</span><span class="p">()</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">set_stopping_condition_info</span><span class="p">(</span><span class="n">stopping_index</span><span class="p">,</span> <span class="n">COLLISION_DETECTION</span><span class="p">)</span>
<span class="c">!...</span>
  <span class="n">ENDIF</span>
<span class="n">ENDIF</span>
</pre></div>
</div>
</li>
<li><p class="first">Break the outer loop when any condition is set. The
<a class="reference internal" href="#c.set_conditions" title="set_conditions"><code class="xref c c-data docutils literal notranslate"><span class="pre">set_conditions</span></code></a> can be tested:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">while</span><span class="p">(...)</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="k">if</span><span class="p">(</span><span class="n">set_conditions</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">INCLUDE</span> <span class="s2">&quot;../../lib/stopcond/stopcond.inc&quot;</span>
<span class="kt">INTEGER</span><span class="kd">::</span><span class="n">is_any_condition_set</span>
<span class="k">DO WHILE</span> <span class="p">()</span>
<span class="c">!...</span>
  <span class="k">IF</span> <span class="p">(</span><span class="n">is_any_condition_set</span><span class="p">().</span><span class="n">EQ</span><span class="p">.</span><span class="mi">1</span><span class="p">)</span> <span class="k">EXIT</span>

<span class="k">END DO</span>
</pre></div>
</div>
</li>
</ol>
<p>A good example of a code implementing the stopping conditions
is the “hermite0” community code. The code can be found
in the ‘src/amuse/community/hermite0’ directory.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="from_codes_to_data.html" class="btn btn-neutral float-right" title="From Codes to Data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="report.html" class="btn btn-neutral float-left" title="Reporting during a run" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2009-2019 The AMUSE Team

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
    <!-- Piwik -->
<script type="text/javascript">
var pkBaseURL = (("https:" == document.location.protocol) ? "https://stats.amusecode.org/" : "http://stats.amusecode.org/");
document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
</script><script type="text/javascript">
try {
var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 1);
piwikTracker.trackPageView();
piwikTracker.enableLinkTracking();
} catch( err ) {}
</script><noscript><p><img src="http://stats.amusecode.org/piwik.php?idsite=1" style="border:0" alt="" /></p></noscript>
<!-- End Piwik Tracking Code -->

     


</body>
</html>
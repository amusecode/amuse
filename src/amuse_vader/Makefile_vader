CFLAGS   += -Wall -g
#CXXFLAGS += $(CFLAGS)
LDFLAGS  += -lm $(MUSE_LD_FLAGS)

# Set Anderson acceleration parameter, default 0
# Seems faster without Anderson acceleration
AA_M = 0
CXXFLAGS += -DAA_M=$(AA_M)

USERFUNCS := $(patsubst %,prob/userFunc_%.o,$(PROBS))

CODELIB = libvader.a

CODEOBJS = advanceBE.o advanceCN.o applyBC.o checkpoint.o driver.o getNextIterate.o init.o ppmExtrap.o rotCurveSpline.o testingMode.o vader.o

AR ?= ar
RANLIB ?= ranlib
RM ?= rm

all: $(CODELIB) $(USERFUNCS)


clean:
	$(RM) -f *.o *.a

$(CODELIB): $(CODEOBJS)
	$(RM) -f $@
	$(AR) ruv $@ $(CODEOBJS)
	$(RANLIB) $@


.cc.o: $<
	$(MPICC) $(CXXFLAGS) -c -o $@ $<

.c.o: $<
	$(MPICC) $(CXXFLAGS) -c -o $@ $<

prob/%.o: prob/%.c
	$(MPICC) $(CXXFLAGS) -I. -c -o $@ $<
